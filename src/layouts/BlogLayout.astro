---
import Layout from './Layout.astro';
import siteData from '../data/siteData.json';

interface Props {
  frontmatter: {
    title: string;
    description: string;
    publishDate: string;
    heroImage?: string;
    ogImage?: string;
    author?: string;
    tags?: string[];
    slug?: string;
  };
}

const { frontmatter } = Astro.props;

// Format date
const publishDate = new Date(frontmatter.publishDate);
const formattedDate = publishDate.toLocaleDateString('en-GB', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Calculate reading time (rough estimate)
const wordsPerMinute = 200;
try {
  const content = await Astro.slots.render('default');
  const wordCount = content.replace(/<[^>]*>/g, '').split(' ').length;
  var readingTime = Math.ceil(wordCount / wordsPerMinute);
} catch (error) {
  // Fallback calculation based on description
  const descriptionWords = frontmatter.description ? frontmatter.description.split(' ').length : 50;
  var readingTime = Math.ceil((descriptionWords * 15) / wordsPerMinute);
}

// Generate slug
const slug = frontmatter.slug || Astro.url.pathname.split('/').pop();

// Schema markup for blog post
const blogPostSchema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": frontmatter.title,
  "description": frontmatter.description,
  "image": frontmatter.heroImage ? `https://${siteData.site.domain}${frontmatter.heroImage}` : `https://${siteData.site.domain}/images/bishopsstortfordwindows-heroimage.webp`,
  "author": {
    "@type": "Person",
    "name": frontmatter.author || "Oliver Greene",
    "description": "38-year veteran of the UK window industry; founder of Windows Bishop's Stortford helping homeowners find vetted local installers.",
    "jobTitle": "Managing Director & Industry Expert",
    "knowsAbout": [
      "Window installation",
      "Double glazing", 
      "Energy efficiency",
      "Building regulations Part L",
      "FENSA certification"
    ]
  },
  "publisher": {
    "@type": "Organization",
    "name": siteData.business.name,
    "logo": {
      "@type": "ImageObject",
      "url": `https://${siteData.site.domain}/images/windows-logo-cropped.svg`
    }
  },
  "datePublished": frontmatter.publishDate,
  "dateModified": frontmatter.publishDate,
  "url": `https://${siteData.site.domain}/blog/${slug}`,
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": `https://${siteData.site.domain}/blog/${slug}`
  },
  "keywords": frontmatter.tags?.join(', '),
  "articleSection": "Window Installation and Repair",
  "inLanguage": "en-GB",
  "isPartOf": {
    "@type": "Blog",
    "name": "Windows Bishop's Stortford Blog",
    "url": `https://${siteData.site.domain}/blog`
  }
};

// Breadcrumb schema
const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": `https://${siteData.site.domain}`
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": `https://${siteData.site.domain}/blog`
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": frontmatter.title,
      "item": `https://${siteData.site.domain}/blog/${slug}`
    }
  ]
};

const schema = [blogPostSchema, breadcrumbSchema];

// SEO title and description
const seoTitle = `${frontmatter.title} | Windows Bishop's Stortford Blog`;
const seoDescription = frontmatter.description;
---

<Layout title={seoTitle} description={seoDescription} schema={schema}>
  <!-- Hero Section with Featured Image -->
  <section class="relative">
    {frontmatter.heroImage ? (
      <div class="relative h-[65vh] md:h-[70vh] overflow-hidden flex items-center">
        <img 
          src={frontmatter.heroImage}
          alt={frontmatter.title}
          class="w-full h-full object-cover"
          loading="eager"
        />
        <div class="absolute inset-0 bg-black bg-opacity-60"></div>
        
        <!-- Hero Content Overlay -->
        <div class="absolute inset-0 flex items-center">
          <div class="container-custom">
            <div class="max-w-4xl">
              <!-- Tags -->
              {frontmatter.tags && frontmatter.tags.length > 0 && (
                <div class="flex flex-wrap gap-1 sm:gap-2 mb-6 mt-4 sm:mt-0">
                  {frontmatter.tags.map((tag) => (
                    <a 
                      href={`/blog/tag/${tag}`}
                      class="bg-white bg-opacity-20 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-medium hover:bg-opacity-30 transition-colors backdrop-blur-sm"
                    >
                      {tag.charAt(0).toUpperCase() + tag.slice(1)}
                    </a>
                  ))}
                </div>
              )}

              <!-- Title -->
              <h1 class="text-3xl lg:text-5xl font-extrabold text-white mb-6 leading-tight tracking-tighter">
                {frontmatter.title}
              </h1>

              <!-- Meta Information -->
              <div class="flex flex-col sm:flex-row sm:items-center text-green-100">
                <!-- Author -->
                <div class="flex items-center mb-4 sm:mb-0 sm:mr-8">
                  <div class="w-10 h-10 rounded-full mr-3 overflow-hidden ring-2 ring-white ring-opacity-50">
                    <img 
                      src="/images/oliver-greene-profilepic_compressed_compressed.webp"
                      alt="Oliver Greene - Window Expert"
                      class="w-full h-full object-cover"
                      loading="lazy"
                    />
                  </div>
                  <div class="leading-none -space-y-2">
                    <p class="font-semibold text-white leading-none">{frontmatter.author || "Oliver Greene"}</p>
                    <p class="text-xs text-green-200 leading-none">Window Expert</p>
                  </div>
                </div>

                <!-- Date & Reading Time -->
                <div class="flex items-center space-x-6 text-sm text-green-100">
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <time datetime={frontmatter.publishDate}>{formattedDate}</time>
                  </div>
                  <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>{readingTime} min read</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    ) : (
      <div class="h-32 bg-gradient-to-r from-green-600 to-green-500"></div>
    )}
  </section>

  <!-- Article Content -->
  <article class="section-padding bg-white">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto">
        <!-- Breadcrumbs -->
        <nav aria-label="Breadcrumb" class="mb-8">
          <ol class="flex items-center space-x-2 text-sm text-gray-500">
            <li>
              <a href="/" class="hover:text-green-600 transition-colors">Home</a>
            </li>
            <li class="text-gray-400">/</li>
            <li>
              <a href="/blog" class="hover:text-green-600 transition-colors">Blog</a>
            </li>
            <li class="text-gray-400">/</li>
            <li class="text-gray-700 font-medium">{frontmatter.title}</li>
          </ol>
        </nav>

        <!-- Article Content -->
        <div class="prose prose-lg max-w-none">
          <div class="text-xl text-gray-600 font-medium leading-relaxed mb-12 pb-8 border-b border-gray-200">
            {frontmatter.description}
          </div>
          
          <div class="article-content">
            <slot />
          </div>
        </div>
        
        <!-- Share buttons -->
        <div class="flex items-center justify-center space-x-4 mt-12 pt-8 border-t border-gray-200">
          <span class="text-sm text-gray-500 mr-2">Share this article:</span>
          <button class="p-3 text-gray-400 hover:text-green-600 transition-colors bg-gray-50 hover:bg-green-50 rounded-full" aria-label="Share on Twitter">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path d="M6.29 18.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0020 3.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.073 4.073 0 01.8 7.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 010 16.407a11.616 11.616 0 006.29 1.84"></path>
            </svg>
          </button>
          <button class="p-3 text-gray-400 hover:text-green-600 transition-colors bg-gray-50 hover:bg-green-50 rounded-full" aria-label="Share on LinkedIn">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M16.338 16.338H13.67V12.16c0-.995-.017-2.277-1.387-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248H8.014v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.778 3.203 4.092v4.711zM5.005 6.575a1.548 1.548 0 11-.003-3.096 1.548 1.548 0 01.003 3.096zm-1.337 9.763H6.34v-8.59H3.667v8.59zM17.668 1H2.328C1.595 1 1 1.581 1 2.298v15.403C1 18.418 1.595 19 2.328 19h15.34c.734 0 1.332-.582 1.332-1.299V2.298C19 1.581 18.402 1 17.668 1z" clip-rule="evenodd"></path>
            </svg>
          </button>
        </div>

        <!-- Author Bio -->
        <section class="mt-16 p-8 bg-gray-50 rounded-3xl">
          <div class="flex flex-col md:flex-row items-start gap-6">
            <div class="flex-shrink-0">
              <div class="w-20 h-20 rounded-3xl overflow-hidden ring-4 ring-green-100">
                <img 
                  src="/images/oliver-greene-profilepic_compressed_compressed.webp"
                  alt="Oliver Greene - Window Expert"
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
            </div>
            <div class="flex-1">
              <h3 class="text-2xl font-bold text-green-800 mb-2">About {frontmatter.author || "Oliver Greene"}</h3>
              <p class="text-gray-600 leading-relaxed mb-4">
                38-year veteran of the UK window industry and founder of Windows Bishop's Stortford. Oliver helps homeowners navigate window installation, repairs, and energy efficiency improvements by connecting them with trusted local specialists throughout Hertfordshire.
              </p>
              <div class="flex flex-wrap gap-2">
                <span class="service-tag text-xs">Window Installation Expert</span>
                <span class="service-tag text-xs">FENSA Certified</span>
                <span class="service-tag text-xs">Building Regulations Specialist</span>
              </div>
            </div>
          </div>
        </section>

        <!-- CTA Section -->
        <section class="mt-16 p-8 hero-gradient text-white rounded-3xl text-center">
          <h3 class="text-2xl lg:text-3xl font-extrabold mb-4 text-white">
            Need Professional Window Services?
          </h3>
          <p class="text-green-50 mb-6 leading-relaxed">
            Get connected with Bishop's Stortford's most trusted window specialists for your next project.
          </p>
          <a 
            href="#contact" 
            class="btn-primary bg-white text-green-600 hover:bg-gray-100 inline-flex items-center group"
          >
            <span>Get Free Quotes</span>
            <svg class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
            </svg>
          </a>
        </section>
      </div>
    </div>
  </article>

  <!-- Related Posts Section (Placeholder for future implementation) -->
  <section class="section-padding bg-gray-50">
    <div class="container-custom">
      <div class="max-w-4xl mx-auto">
        <h3 class="text-3xl font-extrabold text-green-800 mb-8 text-center tracking-tight">
          Related Articles
        </h3>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          <!-- Related posts will be populated here -->
          <div class="card p-6 text-center">
            <div class="w-12 h-12 bg-green-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
              <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
              </svg>
            </div>
            <h4 class="text-lg font-bold text-green-800 mb-2">More Articles Coming Soon</h4>
            <p class="text-gray-600 text-sm">Check back for more expert window advice and guides.</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Custom prose styles for article content */
  .article-content {
    @apply text-gray-700 leading-relaxed;
  }

  .article-content h2 {
    @apply text-xl lg:text-2xl font-bold text-green-800 mt-20 mb-8 tracking-tight;
  }

  .article-content h3 {
    @apply text-lg lg:text-xl font-bold text-green-800 mt-16 mb-6 tracking-tight;
  }

  .article-content h4 {
    @apply text-base lg:text-lg font-bold text-green-800 mt-12 mb-4 tracking-tight;
  }

  .article-content p {
    @apply mb-8 leading-relaxed;
  }

  .article-content h2 + p,
  .article-content h3 + p,
  .article-content h4 + p {
    @apply mt-6;
  }

  .article-content ul, .article-content ol {
    @apply mb-10 pl-6 space-y-3;
  }

  .article-content li {
    @apply leading-relaxed;
  }

  .article-content ul li {
    @apply list-disc;
  }

  .article-content ol li {
    @apply list-decimal;
  }

  /* Special styling for bullet point lists */
  .article-content ul li strong {
    @apply text-green-800;
  }

  /* Add more space between different content blocks */
  .article-content > * + * {
    @apply mt-8;
  }

  .article-content h2 + *,
  .article-content h3 + *,
  .article-content h4 + * {
    @apply mt-6;
  }

  .article-content ul li {
    @apply list-disc;
  }

  .article-content ol li {
    @apply list-decimal;
  }

  .article-content blockquote {
    @apply border-l-4 border-green-500 pl-6 my-12 italic text-gray-600 bg-green-50 py-6 rounded-r-lg;
  }

  .article-content code {
    @apply bg-gray-100 px-2 py-1 rounded text-sm font-mono;
  }

  .article-content pre {
    @apply bg-gray-100 p-4 rounded-lg overflow-x-auto mb-10;
  }

  .article-content pre code {
    @apply bg-transparent p-0;
  }

  .article-content a {
    @apply text-green-600 hover:text-green-700 underline decoration-green-600 hover:decoration-green-700 underline-offset-2 transition-colors font-medium;
  }

  /* Ensure green links override prose styles */
  .prose a {
    @apply text-green-600 hover:text-green-700 underline decoration-green-600 hover:decoration-green-700 underline-offset-2 transition-colors font-medium;
  }

  .article-content img {
    @apply rounded-2xl shadow-lg my-12 w-full;
  }

  .article-content table {
    @apply w-full border-collapse border border-gray-300 mb-10 overflow-x-auto;
  }

  .article-content th, .article-content td {
    @apply border border-gray-300 px-4 py-3 text-left text-sm;
  }

  .article-content th {
    @apply bg-gray-50 font-semibold;
  }

  /* Responsive text sizing */
  @media (max-width: 640px) {
    .article-content h2 {
      @apply text-lg mt-16 mb-6;
    }
    
    .article-content h3 {
      @apply text-base mt-12 mb-4;
    }
    
    .article-content h4 {
      @apply text-sm mt-10 mb-3;
    }
    
    .article-content p {
      @apply text-sm mb-6;
    }
    
    .article-content li {
      @apply text-sm;
    }
    
    .article-content ul, .article-content ol {
      @apply mb-8 space-y-2;
    }
    
    .article-content th, .article-content td {
      @apply px-2 py-2 text-xs;
    }
    
    .article-content blockquote {
      @apply my-8 py-4;
    }
    
    .article-content img {
      @apply my-8;
    }
  }
</style> 